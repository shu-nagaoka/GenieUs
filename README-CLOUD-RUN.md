# ğŸš€ GenieUs Cloud Run çµ±åˆãƒ‡ãƒ—ãƒ­ã‚¤ãƒ¡ãƒ³ãƒˆã‚¬ã‚¤ãƒ‰

ã‚¨ãƒ³ãƒˆãƒªãƒ¼ãƒã‚¤ãƒ³ãƒˆ `./entrypoint.sh` ã‹ã‚‰Cloud Runãƒ‡ãƒ—ãƒ­ã‚¤ãƒ¡ãƒ³ãƒˆã‚’çµ±åˆç®¡ç†ã™ã‚‹ãŸã‚ã®ã‚¬ã‚¤ãƒ‰ã§ã™ã€‚

## ğŸ“‹ ã‚¯ã‚¤ãƒƒã‚¯ã‚¹ã‚¿ãƒ¼ãƒˆ

### 1. ã‚¨ãƒ³ãƒˆãƒªãƒ¼ãƒã‚¤ãƒ³ãƒˆèµ·å‹•

```bash
# ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ«ãƒ¼ãƒˆã‹ã‚‰å®Ÿè¡Œ
./entrypoint.sh
```

### 2. Cloud Run ãƒ¡ãƒ‹ãƒ¥ãƒ¼ä½¿ç”¨

ã‚¨ãƒ³ãƒˆãƒªãƒ¼ãƒã‚¤ãƒ³ãƒˆãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‹ã‚‰ä»¥ä¸‹ã®ã‚ªãƒ—ã‚·ãƒ§ãƒ³ãŒåˆ©ç”¨å¯èƒ½:

```
â˜ï¸  Cloud Run ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ¡ãƒ³ãƒˆ
  12) Cloud Run ã‚¹ãƒ†ãƒ¼ã‚¸ãƒ³ã‚° ãƒ‡ãƒ—ãƒ­ã‚¤
  13) Cloud Run æœ¬ç•ª ãƒ‡ãƒ—ãƒ­ã‚¤
  14) Cloud Run ã‚µãƒ¼ãƒ“ã‚¹çŠ¶æ…‹ç¢ºèª
  15) Cloud Run ãƒ­ã‚°ç¢ºèª
  16) Cloud Run è¨­å®šãƒ»ç’°å¢ƒç¢ºèª
```

## ğŸ”§ äº‹å‰è¨­å®š

### å¿…è¦ãªç’°å¢ƒå¤‰æ•°

```bash
# ~/.bashrc ã¾ãŸã¯ ~/.zshrc ã«è¿½åŠ 
export GCP_PROJECT_ID="your-project-id"
export GCP_REGION="asia-northeast1"
export GCP_SERVICE_ACCOUNT="genius-backend-sa"
```

### èªè¨¼è¨­å®š

```bash
# Google Cloudèªè¨¼
gcloud auth login
gcloud config set project your-project-id

# Dockerèªè¨¼
gcloud auth configure-docker asia-northeast1-docker.pkg.dev
```

## ğŸ“± ä½¿ç”¨æ–¹æ³•

### ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ¡ãƒ³ãƒˆæ“ä½œ

#### ğŸŸ¡ ã‚¹ãƒ†ãƒ¼ã‚¸ãƒ³ã‚°ç’°å¢ƒãƒ‡ãƒ—ãƒ­ã‚¤ (ã‚ªãƒ—ã‚·ãƒ§ãƒ³ 12)
```bash
./entrypoint.sh
# ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã§ã€Œ12ã€ã‚’é¸æŠ
```

- **è‡ªå‹•å®Ÿè¡Œå†…å®¹**:
  - å‰ææ¡ä»¶ãƒã‚§ãƒƒã‚¯
  - ã‚¹ãƒ†ãƒ¼ã‚¸ãƒ³ã‚°ç’°å¢ƒã¸ã®ãƒ‡ãƒ—ãƒ­ã‚¤
  - ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯

#### ğŸ”´ æœ¬ç•ªç’°å¢ƒãƒ‡ãƒ—ãƒ­ã‚¤ (ã‚ªãƒ—ã‚·ãƒ§ãƒ³ 13)
```bash
./entrypoint.sh
# ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã§ã€Œ13ã€ã‚’é¸æŠ
# ç¢ºèªã®ãŸã‚ã€Œproductionã€ã¨å…¥åŠ›
```

- **å®‰å…¨æ©Ÿèƒ½**:
  - 2é‡ç¢ºèªï¼ˆã€Œproductionã€å…¥åŠ›å¿…é ˆï¼‰
  - å‰ææ¡ä»¶ãƒã‚§ãƒƒã‚¯
  - è©³ç´°ãƒ­ã‚°å‡ºåŠ›

### ç›£è¦–ãƒ»é‹ç”¨æ“ä½œ

#### ğŸ“Š ã‚µãƒ¼ãƒ“ã‚¹çŠ¶æ…‹ç¢ºèª (ã‚ªãƒ—ã‚·ãƒ§ãƒ³ 14)
```bash
./entrypoint.sh
# ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã§ã€Œ14ã€ã‚’é¸æŠ
```

- **ç¢ºèªå†…å®¹**:
  - å…¨ã‚µãƒ¼ãƒ“ã‚¹ä¸€è¦§è¡¨ç¤º
  - å€‹åˆ¥ã‚µãƒ¼ãƒ“ã‚¹è©³ç´°
  - URLãƒ»ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ç¢ºèª

#### ğŸ“ ãƒ­ã‚°ç¢ºèª (ã‚ªãƒ—ã‚·ãƒ§ãƒ³ 15)
```bash
./entrypoint.sh
# ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã§ã€Œ15ã€ã‚’é¸æŠ
```

- **ãƒ­ã‚°ã‚¿ã‚¤ãƒ—**:
  - ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ãƒ­ã‚°
  - æœ€æ–°ãƒ­ã‚°ï¼ˆ50è¡Œï¼‰
  - ã‚¨ãƒ©ãƒ¼ãƒ­ã‚°ã®ã¿

#### âš™ï¸ ç’°å¢ƒè¨­å®šç¢ºèª (ã‚ªãƒ—ã‚·ãƒ§ãƒ³ 16)
```bash
./entrypoint.sh
# ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã§ã€Œ16ã€ã‚’é¸æŠ
```

- **ãƒã‚§ãƒƒã‚¯é …ç›®**:
  - ç’°å¢ƒå¤‰æ•°è¨­å®š
  - gcloud CLIçŠ¶æ…‹
  - DockerçŠ¶æ…‹
  - å¿…è¦ãƒ•ã‚¡ã‚¤ãƒ«å­˜åœ¨ç¢ºèª

## ğŸ¯ å…¸å‹çš„ãªãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼

### åˆå›ãƒ‡ãƒ—ãƒ­ã‚¤

1. **ç’°å¢ƒè¨­å®šç¢ºèª**
   ```bash
   ./entrypoint.sh â†’ 16 (Cloud Run è¨­å®šãƒ»ç’°å¢ƒç¢ºèª)
   ```

2. **ã‚¹ãƒ†ãƒ¼ã‚¸ãƒ³ã‚° ãƒ‡ãƒ—ãƒ­ã‚¤**
   ```bash
   ./entrypoint.sh â†’ 12 (Cloud Run ã‚¹ãƒ†ãƒ¼ã‚¸ãƒ³ã‚° ãƒ‡ãƒ—ãƒ­ã‚¤)
   ```

3. **å‹•ä½œç¢ºèª**
   ```bash
   ./entrypoint.sh â†’ 14 (Cloud Run ã‚µãƒ¼ãƒ“ã‚¹çŠ¶æ…‹ç¢ºèª)
   ```

4. **æœ¬ç•ªãƒ‡ãƒ—ãƒ­ã‚¤**
   ```bash
   ./entrypoint.sh â†’ 13 (Cloud Run æœ¬ç•ª ãƒ‡ãƒ—ãƒ­ã‚¤)
   ```

### æ—¥å¸¸é‹ç”¨

1. **ãƒ­ã‚°ç›£è¦–**
   ```bash
   ./entrypoint.sh â†’ 15 (Cloud Run ãƒ­ã‚°ç¢ºèª)
   ```

2. **ã‚µãƒ¼ãƒ“ã‚¹çŠ¶æ…‹ç¢ºèª**
   ```bash
   ./entrypoint.sh â†’ 14 (Cloud Run ã‚µãƒ¼ãƒ“ã‚¹çŠ¶æ…‹ç¢ºèª)
   ```

3. **æ›´æ–°ãƒ‡ãƒ—ãƒ­ã‚¤**
   ```bash
   ./entrypoint.sh â†’ 12/13 (ãƒ‡ãƒ—ãƒ­ã‚¤)
   ```

## ğŸ” ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

### ã‚ˆãã‚ã‚‹ã‚¨ãƒ©ãƒ¼ã¨å¯¾å‡¦æ³•

#### âŒ "gcloud CLIãŒã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚Œã¦ã„ã¾ã›ã‚“"
```bash
# macOS
brew install google-cloud-sdk

# Linux
curl https://sdk.cloud.google.com | bash
```

#### âŒ "GCPã«ãƒ­ã‚°ã‚¤ãƒ³ã—ã¦ã„ã¾ã›ã‚“"
```bash
gcloud auth login
gcloud config set project your-project-id
```

#### âŒ "DockerãŒèµ·å‹•ã—ã¦ã„ã¾ã›ã‚“"
```bash
# Docker Desktopã‚’èµ·å‹•
open -a Docker

# ã¾ãŸã¯ã‚³ãƒãƒ³ãƒ‰ãƒ©ã‚¤ãƒ³
sudo systemctl start docker  # Linux
```

#### âŒ "GCP_PROJECT_IDç’°å¢ƒå¤‰æ•°ãŒæœªè¨­å®š"
```bash
export GCP_PROJECT_ID="your-project-id"
# ã¾ãŸã¯ ~/.bashrc ã«æ°¸ç¶šåŒ–
echo 'export GCP_PROJECT_ID="your-project-id"' >> ~/.bashrc
```

### ãƒ‡ãƒ—ãƒ­ã‚¤å¤±æ•—æ™‚ã®å¯¾å‡¦

1. **ç’°å¢ƒè¨­å®šç¢ºèª**
   ```bash
   ./entrypoint.sh â†’ 16
   ```

2. **ãƒ­ã‚°ç¢ºèª**
   ```bash
   ./entrypoint.sh â†’ 15
   ```

3. **æ‰‹å‹•ãƒ‡ãƒ—ãƒ­ã‚¤å®Ÿè¡Œ**
   ```bash
   ./scripts/deploy-cloud-run.sh staging --debug
   ```

## ğŸ”„ CI/CDé€£æº

ã‚¨ãƒ³ãƒˆãƒªãƒ¼ãƒã‚¤ãƒ³ãƒˆã‹ã‚‰ã®ãƒ‡ãƒ—ãƒ­ã‚¤ã¨GitHub Actionsã®ä½¿ã„åˆ†ã‘:

### æ‰‹å‹•ãƒ‡ãƒ—ãƒ­ã‚¤ï¼ˆã‚¨ãƒ³ãƒˆãƒªãƒ¼ãƒã‚¤ãƒ³ãƒˆï¼‰
- **ç”¨é€”**: é–‹ç™ºãƒ»ãƒ†ã‚¹ãƒˆãƒ»ç·Šæ€¥ãƒ‡ãƒ—ãƒ­ã‚¤
- **åˆ©ç‚¹**: ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ãƒ†ã‚£ãƒ–ãƒ»å³åº§å®Ÿè¡Œ
- **å®Ÿè¡Œ**: `./entrypoint.sh â†’ 12/13`

### è‡ªå‹•ãƒ‡ãƒ—ãƒ­ã‚¤ï¼ˆGitHub Actionsï¼‰
- **ç”¨é€”**: æœ¬ç•ªãƒªãƒªãƒ¼ã‚¹ãƒ»å®šæœŸãƒ‡ãƒ—ãƒ­ã‚¤
- **åˆ©ç‚¹**: å±¥æ­´ç®¡ç†ãƒ»å“è³ªã‚²ãƒ¼ãƒˆ
- **å®Ÿè¡Œ**: `git push origin main`

## ğŸ“‹ ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ

### ãƒ‡ãƒ—ãƒ­ã‚¤å‰ãƒã‚§ãƒƒã‚¯

- [ ] GCP_PROJECT_IDè¨­å®šæ¸ˆã¿
- [ ] gcloudèªè¨¼æ¸ˆã¿
- [ ] Dockerèµ·å‹•æ¸ˆã¿
- [ ] ç’°å¢ƒãƒ•ã‚¡ã‚¤ãƒ«ä½œæˆæ¸ˆã¿
- [ ] Google OAuthè¨­å®šæ¸ˆã¿

### ãƒ‡ãƒ—ãƒ­ã‚¤å¾Œãƒã‚§ãƒƒã‚¯

- [ ] ã‚µãƒ¼ãƒ“ã‚¹çŠ¶æ…‹ç¢ºèª
- [ ] URLå‹•ä½œç¢ºèª
- [ ] ãƒ­ã‚°ã‚¨ãƒ©ãƒ¼ç¢ºèª
- [ ] ç’°å¢ƒå¤‰æ•°ç¢ºèª

## ğŸ†˜ ç·Šæ€¥æ™‚å¯¾å¿œ

### ã‚µãƒ¼ãƒ“ã‚¹åœæ­¢
```bash
# ç·Šæ€¥åœæ­¢
gcloud run services update genius-backend-production \
  --region=asia-northeast1 \
  --min-instances=0 \
  --max-instances=0
```

### ãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯
```bash
# å‰ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã«æˆ»ã™
gcloud run services update genius-backend-production \
  --region=asia-northeast1 \
  --image=gcr.io/PROJECT_ID/genius-backend:previous-tag
```

---

## ğŸ”— é–¢é€£ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ

- [Cloud Run ã‚¤ãƒ³ãƒ•ãƒ©è¨­è¨ˆ](docs/architecture/cloud-infrastructure.md)
- [è©³ç´°ãƒ‡ãƒ—ãƒ­ã‚¤ã‚¬ã‚¤ãƒ‰](docs/DEPLOYMENT.md)
- [GitHub Actionsè¨­å®š](.github/workflows/deploy-cloud-run.yml)

---

ã“ã‚Œã§ `./entrypoint.sh` ã‹ã‚‰å®Œå…¨ã«Cloud Runãƒ‡ãƒ—ãƒ­ã‚¤ãƒ¡ãƒ³ãƒˆã‚’ç®¡ç†ã§ãã¾ã™ï¼ğŸ‰